
<!-- Main Navigation -->
<nav class="navigation">
    <a href="{{ site.baseurl }}/" {% if page.url == "/" %}class="active"{% endif %}>Home</a>
    
    {% assign main_sections = site.pages | where_exp: "item", "item.url contains '/' and item.url != '/' and item.path contains 'index.md'" | sort: "url" %}
    {% assign top_level_sections = "" | split: "" %}
    
    {% for section in main_sections %}
      {% assign path_parts = section.path | split: "/" %}
      {% if path_parts.size == 3 and path_parts[1] != "_" %}
        {% assign top_level_sections = top_level_sections | push: section %}
      {% endif %}
    {% endfor %}
    
    {% for section in top_level_sections %}
      <a href="{{ site.baseurl }}{{ section.url }}" {% if page.url contains section.url %}class="active"{% endif %}>
        {{ section.title }}
      </a>
    {% endfor %}
  </nav>
  
  <!-- Sub Navigation (Appears when in a section) -->
  {% if page.url contains '/' and page.url != '/' %}
    {% assign current_section = page.url | split: '/' | slice: 1 | first %}
    {% assign sub_sections = site.pages | where_exp: "item", "item.url contains '/' and item.path contains 'index.md'" | sort: "url" %}
    {% assign matching_subsections = "" | split: "" %}
    
    {% for section in sub_sections %}
      {% assign path_parts = section.path | split: "/" %}
      {% if path_parts.size == 4 and path_parts[1] == current_section %}
        {% assign matching_subsections = matching_subsections | push: section %}
      {% endif %}
    {% endfor %}
    
    {% if matching_subsections.size > 0 %}
      <nav class="sub-navigation">
        {% for subsection in matching_subsections %}
          <a href="{{ site.baseurl }}{{ subsection.url }}" {% if page.url contains subsection.url %}class="active"{% endif %}>
            {{ subsection.title }}
          </a>
        {% endfor %}
      </nav>
    {% endif %}
  {% endif %}
  
  <!-- Topic Navigation (Appears when in a subsection) -->
  {% if page.url contains '/' and page.url contains '/' and page.url != '/' %}
    {% assign path_parts = page.url | split: '/' %}
    {% if path_parts.size >= 4 %}
      {% assign current_section = path_parts[1] %}
      {% assign current_subsection = path_parts[2] %}
      {% assign topic_pages = site.pages | where_exp: "item", "item.url contains '/' and item.path contains 'index.md'" | sort: "url" %}
      {% assign matching_topics = "" | split: "" %}
      
      {% for topic in topic_pages %}
        {% assign topic_path_parts = topic.path | split: "/" %}
        {% if topic_path_parts.size == 5 and topic_path_parts[1] == current_section and topic_path_parts[2] == current_subsection %}
          {% assign matching_topics = matching_topics | push: topic %}
        {% endif %}
      {% endfor %}
      
      {% if matching_topics.size > 0 %}
        <nav class="topic-navigation">
          {% for topic in matching_topics %}
            <a href="{{ site.baseurl }}{{ topic.url }}" {% if page.url == topic.url %}class="active"{% endif %}>
              {{ topic.title }}
            </a>
          {% endfor %}
        </nav>
      {% endif %}
    {% endif %}
  {% endif %}